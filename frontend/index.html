<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schrödingers Minispiele</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./scss/style.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    
    <div class="overview"> 
        <div>
            <div id="grid">
                <game-component>
                    <live-view-component>Live View</live-view-component>

                    <map-component></map-component>

                    <div class="diary">
                        <div>
                            <diary-component></diary-component>
                        </div>
                    </div>
                </game-component>
                
                <chat-component></chat-component>
            </div>
        </div> 
    </div>

    <div id="minigames">

        <wordgame-component></wordgame-component>

        <div class="game" id="shadow-pingpong">
            <style>
                #shadow-pingpong body{
                    background-color: dimgray;
                }
                #shadow-pingpong #pong{
                    border: 2px solid #FFF;
                    position: absolute;
                    margin :auto;
                    top:0;
                    right:0;
                    left:0;
                    bottom:0;
                }
            </style>

            <canvas id="pong" width="600" height="400"></canvas>

            <script>
                const canvas = document.getElementById("pong");
                const ctx = canvas.getContext("2d");

                const user = { //user object
                    x: 0,
                    y: (canvas.height-50)/2 ,
                    width: 10,
                    height: 100,
                    color: "WHITE",
                    score: 0
                }

                const com = { //computer object
                    x: canvas.width -10,
                    y: canvas.height/2 - 50,
                    width: 10,
                    height: 100,
                    color: "WHITE",
                    score: 0
                }

                const net = { //net object
                    x: canvas.width/2 - 1,
                    y: 0,
                    width: 2,
                    height: 10,
                    color: "WHITE"
                }

                const ball = { //ball object
                    x: canvas.width/2,
                    y: canvas.height/2,
                    radius: 10,
                    speed: 5,
                    velocityX: 5,
                    velocityY: 5,
                    color: "WHITE"
                }


                //draw functions
                function drawRect(x, y, w, h, color){
                    ctx.fillStyle = color;
                    ctx.fillRect(x, y, w, h);
                }

                function drawCircle(x, y, r, color){
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(x,y,r,0, Math.PI*2, false);
                    ctx.closePath();
                    ctx.fill()
                }

                function drawText(text, x, y, color){
                    ctx.fillStyle = color;
                    ctx.font = "75px fantasy";
                    ctx.fillText(text, x, y)
                }

                function drawNet(){
                    for(let i = 0; i <= canvas.height; i+=15){
                        drawRect(net.x, net.y+i, net.width, net.height, net.color);
                    }
                }

                let rectX = 0;
                function render(){
                    drawRect(0, 0, canvas.width, canvas.height, "black"); //canvas
                    drawText(user.score, canvas.width/4, canvas.height/5, "WHITE"); //user score
                    drawText(com.score, 3*canvas.width/4, canvas.height/5, "WHITE"); //com score
                    drawRect(user.x, user.y, user.width, user.height, user.color); //user panel
                    drawRect(com.x, com.y, com.width, com.height, com.color); //com panel
                    drawNet(); //net
                    drawCircle(ball.x, ball.y, ball.radius, ball.color); //ball
                }

                //control the user paddle
                canvas.addEventListener("mousemove", movePaddle);

                function movePaddle(evt){
                    let rect = canvas.getBoundingClientRect();
                    user.y = evt.clientY - rect.top - user.height/2;
                }

                function resetBall(){
                    ball.x = canvas.width/2;
                    ball.y = canvas.height/2;

                    ball.speed = 5;
                    ball.velocityX = -ball.velocityX;
                }


                function collision(b, p){
                    p.top = p.y;
                    p.bottom = p.y + p.height;
                    p.left = p.x;
                    p.right = p.x + p.width;

                    b.top = b.y - b.radius;
                    b.bottom = b.y + b.radius;
                    b.left = b.x - b.radius;
                    b.right = b.x + b.radius;

                    //returns if collision or not
                    return p.left < b.right && p.top < b.bottom && p.right > b.left && p.bottom > b.top;
                }

                //logic behind the game
                function update(){
                    ball.x += ball.velocityX;
                    ball.y += ball.velocityY;

                    //control computer paddle
                    let computerLevel = 0.07;
                    com.y += ((ball.y - (com.y + com.height/2))) * computerLevel;

                    if(ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0){
                        ball.velocityY = -ball.velocityY;
                    }

                    let player = (ball.x < canvas.width/2) ? user : com;

                    if(collision(ball, player)){
                        let collidePoint = ball.y - (player.y + player.height/2)

                        collidePoint = collidePoint/(player.height/2);

                        let angleRad = collidePoint * (Math.PI/4);

                        let direction = (ball.x < canvas.width/2) ? 1 : -1;

                        ball.velocityX = direction * ball.speed * Math.cos(angleRad);
                        ball.velocityY = ball.speed * Math.sin(angleRad);

                        ball.speed += 0.4;
                    }

                    else if(ball.x - ball.radius < 0){
                        com.score++;
                        resetBall();
                    }else if(ball.x + ball.radius > canvas.width){
                        user.score++;
                        resetBall();
                    }
                }

                function game(){
                    update();
                    render();
                }

                const framesPerSecond = 50;
                let loop = setInterval(game,1000/framesPerSecond); //call game() 50x every 1s
            </script>
        </div>

        <div class="game" id="shadow-drawguess">
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Rethink+Sans&family=Whisper&display=swap');
                #shadow-drawguess * {
                    font-family: 'Rethink Sans', sans-serif;
                }

                #shadow-drawguess body{
                    padding: 0;
                    margin: 0;
                    color: white;
                }

                #shadow-drawguess h1{
                    margin: 0;
                    padding-top: 5vh;
                }

                #shadow-drawguess{
                    text-align: center;
                    justify-content: center;
                    background-color: #02020B;
                    width: 100vw;
                    height: 100vh
                }

                #shadow-drawguess .life{
                    width: 70px;
                }

                #shadow-drawguess #submit, #guess{
                    height: 50px;
                    border-radius: 10px;
                }

                #shadow-drawguess #guess{
                    margin-top: 20vh;
                    margin-bottom: 20px;
                    width: 325px;
                    background-color: #1c1c1c;
                    border: 3px #a8a8a8 solid;
                    color: white;
                    font-size: 35px;
                }

                #shadow-drawguess #submit{
                    width: 70px;
                    background-color: white;
                }
            </style>

            <h1>Draw and GUESS</h1>
            <h2>What is drawn here?</h2>

            <div>
                <input type="text" name="guess" id="guess">
                <input type="submit" id="submit" onclick="isRightGuess()">
            </div>


            <div id="lifes">
                <img src="./games/drawguess/heart.png" class="life" id="1">
                <img src="./games/drawguess/heart.png" class="life" id="2">
                <img src="./games/drawguess/heart.png" class="life" id="3">
                <img src="./games/drawguess/heart.png" class="life" id="4">
            </div>


            <script>
                let counter = 0;
                function isRightGuess(){
                    if(counter < 4){
                        let guess = document.getElementById("guess").value;
                        console.log(guess);


                        if(guess === getSolution()){
                            console.log("glückwunsch")
                        }
                        else{
                            counter++;
                            let image = document.getElementById(counter);
                            image.src = "./games/drawguess/heart-dead.png";
                            if(counter == 4){
                                console.log("tot")
                            }
                            console.log("bist blind?")
                        }
                    }else{
                        console.log("tot")
                    }
                }

                function getSolution(){
                    return "Katze";
                }
            </script>
        </div>
    </div>
</body>
</html>
